<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style>
.AlignLeft { text-align: left; }
.AlignCenter { text-align: center; }
.AlignRight { text-align: right; }
body { font-family: sans-serif; font-size: 11pt; }
td { vertical-align: top; padding-left: 4px; padding-right: 4px; }

tr.SectionGap td { font-size: 4px; border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionAll td { border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionBegin td { border-left: none; border-top: none; border-right: 1px solid Black; }
tr.SectionEnd td { border-left: none; border-top: none; border-bottom: 1px solid Black; border-right: 1px solid Black; }
tr.SectionMiddle td { border-left: none; border-top: none; border-right: 1px solid Black; }
tr.SubsectionAll td { border-left: none; border-top: none; border-bottom: 1px solid Gray; border-right: 1px solid Black; }
tr.SubsectionEnd td { border-left: none; border-top: none; border-bottom: 1px solid Gray; border-right: 1px solid Black; }
table.fc { border-top: 1px solid Black; border-left: 1px solid Black; width: 100%; font-family: monospace; font-size: 10pt; }
td.TextItemInsigAdd { color: #000000; background-color: #EEEEFF; }
td.TextItemInsigDel { color: #000000; background-color: #EEEEFF; text-decoration: line-through; }
td.TextItemInsigMod { color: #000000; background-color: #EEEEFF; }
td.TextItemInsigOrphan { color: #000000; background-color: #FAEEFF; }
td.TextItemNum { color: #696969; background-color: #F0F0F0; }
td.TextItemSame { color: #000000; background-color: #FFFFFF; }
td.TextItemSigAdd { color: #000000; background-color: #FFE3E3; }
td.TextItemSigDel { color: #000000; background-color: #FFE3E3; text-decoration: line-through; }
td.TextItemSigMod { color: #000000; background-color: #FFE3E3; }
td.TextItemSigOrphan { color: #000000; background-color: #F1E3FF; }
.TextSegInsigDiff { color: #0000FF; }
.TextSegReplacedDiff { color: #0000FF; font-style: italic; }
.TextSegSigDiff { color: #FF0000; }
.TextSegElementKeyword { font-weight: bold; }
.TextSegElementIdentifier { }
.TextSegElementNumber { color: #2E9269; }
.TextSegElementString { color: #3A7726; }
.TextSegElementCompiler_32Directive { color: #681717; }
.TextSegElementComment { color: #786A41; }
.TextSegElementOperator { }
</style>
<title>Text Compare</title>
</head>
<body>
Text Compare<br/>
Produced: 2017/11/28 19:53:46<br/>
&nbsp; &nbsp;
<br/>
Mode:&nbsp; All &nbsp;
<br/>
Left base folder: D:\Users\zhong\Desktop\Target-5.2 &nbsp;
<br/>
Right base folder: D:\Users\zhong\Desktop\Target-5.3 &nbsp;
<br/>
&nbsp; &nbsp;
<br/>
File: usr\spc.c &nbsp;
<br/>
<table class="fc" cellspacing="0" cellpadding="0">
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* SCSI primary command processing</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* SCSI primary command processing</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Copyright (C) 2005-2007 FUJITA Tomonori &lt;tomof@acm.org&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Copyright (C) 2005-2007 FUJITA Tomonori &lt;tomof@acm.org&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Copyright (C) 2005-2007 Mike Christie &lt;michaelc@cs.wisc.edu&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Copyright (C) 2005-2007 Mike Christie &lt;michaelc@cs.wisc.edu&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* This program is free software; you can redistribute it and/or</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* This program is free software; you can redistribute it and/or</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* modify it under the terms of the GNU General Public License as</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* modify it under the terms of the GNU General Public License as</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* published by the Free Software Foundation, version 2 of the</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* published by the Free Software Foundation, version 2 of the</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* License.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* License.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* This program is distributed in the hope that it will be useful, but</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* This program is distributed in the hope that it will be useful, but</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* WITHOUT ANY WARRANTY; without even the implied warranty of</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* WITHOUT ANY WARRANTY; without even the implied warranty of</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* General Public License for more details.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* General Public License for more details.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* You should have received a copy of the GNU General Public License</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* You should have received a copy of the GNU General Public License</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* along with this program; if not, write to the Free Software</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* along with this program; if not, write to the Free Software</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 02110-1301 USA</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 02110-1301 USA</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">errno</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">errno</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">inttypes</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">inttypes</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">stdio</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">stdio</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">stdlib</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">stdlib</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">string</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">string</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">stdint</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementOperator">&lt;</span><span class="TextSegElementIdentifier">stdint</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">h</span><span class="TextSegElementOperator">&gt;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;list.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;list.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;util.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;util.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;tgtd.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;tgtd.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;parser.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;parser.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;target.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;target.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;driver.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;driver.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;tgtadm_error.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;tgtadm_error.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;scsi.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;scsi.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;spc.h&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#include</span> <span class="TextSegElementString">&quot;spc.h&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQUIRY_EVPD</span>&nbsp; &nbsp; <span class="TextSegElementNumber">0x01</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQUIRY_EVPD</span>&nbsp; &nbsp; <span class="TextSegElementNumber">0x01</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PRODUCT_REV</span> <span class="TextSegElementString">&quot;0&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PRODUCT_REV</span> <span class="TextSegElementString">&quot;0&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span>&nbsp; &nbsp; <span class="TextSegElementNumber">4</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span>&nbsp; &nbsp; <span class="TextSegElementNumber">4</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Protocol Identifier Values</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Protocol Identifier Values</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 0 Fibre Channel (FCP-2)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 0 Fibre Channel (FCP-2)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 1 Parallel SCSI (SPI-5)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 1 Parallel SCSI (SPI-5)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 2 SSA (SSA-S3P)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 2 SSA (SSA-S3P)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 3 IEEE 1394 (SBP-3)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 3 IEEE 1394 (SBP-3)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 4 SCSI Remote Direct Memory Access (SRP)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 4 SCSI Remote Direct Memory Access (SRP)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 5 iSCSI</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 5 iSCSI</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6 SAS Serial SCSI Protocol (SAS)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6 SAS Serial SCSI Protocol (SAS)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 7 Automation/Drive Interface (ADT)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 7 Automation/Drive Interface (ADT)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 8 AT Attachment Interface (ATA/ATAPI-7)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 8 AT Attachment Interface (ATA/ATAPI-7)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_FCP</span> <span class="TextSegElementNumber">0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_FCP</span> <span class="TextSegElementNumber">0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SPI</span> <span class="TextSegElementNumber">1</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SPI</span> <span class="TextSegElementNumber">1</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_S3P</span> <span class="TextSegElementNumber">2</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_S3P</span> <span class="TextSegElementNumber">2</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SBP</span> <span class="TextSegElementNumber">3</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SBP</span> <span class="TextSegElementNumber">3</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SRP</span> <span class="TextSegElementNumber">4</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SRP</span> <span class="TextSegElementNumber">4</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_ISCSI</span> <span class="TextSegElementNumber">5</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_ISCSI</span> <span class="TextSegElementNumber">5</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SAS</span> <span class="TextSegElementNumber">6</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_SAS</span> <span class="TextSegElementNumber">6</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_ADT</span> <span class="TextSegElementNumber">7</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_ADT</span> <span class="TextSegElementNumber">7</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_ATA</span> <span class="TextSegElementNumber">8</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_ATA</span> <span class="TextSegElementNumber">8</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_VALID</span> <span class="TextSegElementNumber">0x80</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">PIV_VALID</span> <span class="TextSegElementNumber">0x80</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Code Set</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Code Set</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*&nbsp; 1 - Designator fild contains binary values</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*&nbsp; 1 - Designator fild contains binary values</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*&nbsp; 2 - Designator field contains ASCII printable chars</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*&nbsp; 2 - Designator field contains ASCII printable chars</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*&nbsp; 3 - Designaotor field contains UTF-8</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*&nbsp; 3 - Designaotor field contains UTF-8</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQ_CODE_BIN</span> <span class="TextSegElementNumber">1</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQ_CODE_BIN</span> <span class="TextSegElementNumber">1</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQ_CODE_ASCII</span> <span class="TextSegElementNumber">2</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQ_CODE_ASCII</span> <span class="TextSegElementNumber">2</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQ_CODE_UTF8</span> <span class="TextSegElementNumber">3</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">INQ_CODE_UTF8</span> <span class="TextSegElementNumber">3</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Association field</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Association field</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 00b - Associated with Logical Unit</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 00b - Associated with Logical Unit</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 01b - Associated with target port</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 01b - Associated with target port</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 10b - Associated with SCSI Target device</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 10b - Associated with SCSI Target device</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 11b - Reserved</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 11b - Reserved</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">ASS_LU</span>&nbsp; <span class="TextSegElementNumber">0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">ASS_LU</span>&nbsp; <span class="TextSegElementNumber">0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">ASS_TGT_PORT</span> <span class="TextSegElementNumber">0x10</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">ASS_TGT_PORT</span> <span class="TextSegElementNumber">0x10</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">ASS_TGT_DEV</span> <span class="TextSegElementNumber">0x20</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">ASS_TGT_DEV</span> <span class="TextSegElementNumber">0x20</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Designator type - SPC-4 Reference</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Designator type - SPC-4 Reference</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 0 - Vendor specific - 7.6.3.3</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 0 - Vendor specific - 7.6.3.3</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 1 - T10 vendor ID - 7.6.3.4</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 1 - T10 vendor ID - 7.6.3.4</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 2 - EUI-64 - 7.6.3.5</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 2 - EUI-64 - 7.6.3.5</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 3 - NAA - 7.6.3.6</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 3 - NAA - 7.6.3.6</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 4 - Relative Target port identifier - 7.6.3.7</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 4 - Relative Target port identifier - 7.6.3.7</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 5 - Target Port group - 7.6.3.8</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 5 - Target Port group - 7.6.3.8</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6 - Logical Unit group - 7.6.3.9</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6 - Logical Unit group - 7.6.3.9</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 7 - MD5 logical unit identifier - 7.6.3.10</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 7 - MD5 logical unit identifier - 7.6.3.10</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 8 - SCSI name string - 7.6.3.11</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 8 - SCSI name string - 7.6.3.11</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_VENDOR</span> <span class="TextSegElementNumber">0</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_VENDOR</span> <span class="TextSegElementNumber">0</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_T10</span> <span class="TextSegElementNumber">1</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_T10</span> <span class="TextSegElementNumber">1</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_EUI64</span> <span class="TextSegElementNumber">2</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_EUI64</span> <span class="TextSegElementNumber">2</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_NAA</span> <span class="TextSegElementNumber">3</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_NAA</span> <span class="TextSegElementNumber">3</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_REL_TGT_PORT</span> <span class="TextSegElementNumber">4</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_REL_TGT_PORT</span> <span class="TextSegElementNumber">4</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_TGT_PORT_GRP</span> <span class="TextSegElementNumber">5</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_TGT_PORT_GRP</span> <span class="TextSegElementNumber">5</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_LU_GRP</span> <span class="TextSegElementNumber">6</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_LU_GRP</span> <span class="TextSegElementNumber">6</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_MD5</span> <span class="TextSegElementNumber">7</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_MD5</span> <span class="TextSegElementNumber">7</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_SCSI</span> <span class="TextSegElementNumber">8</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">DESG_SCSI</span> <span class="TextSegElementNumber">8</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_IEEE_EXTD</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementNumber">0x2</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_IEEE_EXTD</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementNumber">0x2</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_LOCAL</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementNumber">0x3</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_LOCAL</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementNumber">0x3</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_IEEE_REGD</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementNumber">0x5</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_IEEE_REGD</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementNumber">0x5</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_IEEE_REGD_EXTD</span>&nbsp; <span class="TextSegElementNumber">0x6</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_IEEE_REGD_EXTD</span>&nbsp; <span class="TextSegElementNumber">0x6</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementNumber">0x8</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementNumber">0x8</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN_EXTD</span>&nbsp;&nbsp; <span class="TextSegElementNumber">0x10</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementCompiler_32Directive">#define</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN_EXTD</span>&nbsp;&nbsp; <span class="TextSegElementNumber">0x10</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_80</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sn</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_80</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sn</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0x20</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0x20</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">strlen</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sn</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">strlen</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sn</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strlen</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sn</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strlen</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sn</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">q</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">q</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">q</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">sn</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">q</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">sn</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(;</span> <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">--)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(;</span> <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">--)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">--)</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">*(</span><span class="TextSegElementIdentifier">q</span><span class="TextSegElementOperator">--);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">--)</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">*(</span><span class="TextSegElementIdentifier">q</span><span class="TextSegElementOperator">--);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_83</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_83</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x83</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x83</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">id_str</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">id_str</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">substring</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementString">&quot;0&quot;</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">substring</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementString">&quot;0&quot;</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">b</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">b</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">c</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">c</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">INQ_CODE_ASCII</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">INQ_CODE_ASCII</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">DESG_T10</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">DESG_T10</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">INQ_CODE_BIN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">INQ_CODE_BIN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">DESG_NAA</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">DESG_NAA</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">NAA_LOCAL</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">NAA_LOCAL</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">INQ_CODE_BIN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">INQ_CODE_BIN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">DESG_NAA</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">DESG_NAA</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN_EXTD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN_EXTD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">DESG_HDR_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * The NAA_DESG_LEN_EXTD field is a 128 bit field</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * The NAA_DESG_LEN_EXTD field is a 128 bit field</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * which contains a numeric value. This loop converts</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * which contains a numeric value. This loop converts</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * the string pointed to by 'id_str' into a right</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * the string pointed to by 'id_str' into a right</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * adjusted numeric value.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; * adjusted numeric value.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">id_str</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">id_str</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">substring</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">id_str</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">substring</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">id_str</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">c</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">60</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">c</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">60</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">&lt;&lt;=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">&lt;&lt;=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">b</span> <span class="TextSegElementOperator">&lt;&lt;=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">b</span> <span class="TextSegElementOperator">&lt;&lt;=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">b</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">c</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">b</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">c</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">strtoul</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">substring</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">a</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">strtoul</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">substring</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">b</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">b</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">a</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">a</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;=</span> <span class="TextSegElementNumber">0x0F</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;=</span> <span class="TextSegElementNumber">0x0F</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">NAA_IEEE_REGD_EXTD</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">NAA_IEEE_REGD_EXTD</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_b2</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_b2</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb2</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb2</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">thinprovisioning</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">thinprovisioning</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementComment">/* threshold exponent */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementComment">/* threshold exponent */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0xe4</span><span class="TextSegElementOperator">;</span>&nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* LBPU LBPWS(10) LBPRZ */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0xe4</span><span class="TextSegElementOperator">;</span>&nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* LBPU LBPWS(10) LBPRZ */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span>&nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* provisioning type */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span>&nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* provisioning type */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_b0</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_vpd_b0</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* maximum compare and write length : 64kb */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* maximum compare and write length : 64kb */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">128</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">128</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">thinprovisioning</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">thinprovisioning</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* maximum unmap lba count : maximum*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* maximum unmap lba count : maximum*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xffffffff</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xffffffff</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* maximum unmap block descriptor count : maximum*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* maximum unmap block descriptor count : maximum*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xffffffff</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xffffffff</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_b0_opt_xfer_gran</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">opt_xfer_gran</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_b0_opt_xfer_gran</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">opt_xfer_gran</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* 4 byte VPD header omitted from data buff */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* 4 byte VPD header omitted from data buff */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be16</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opt_xfer_gran</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be16</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opt_xfer_gran</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_b0_opt_xfer_len</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">opt_xfer_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">update_b0_opt_xfer_len</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">opt_xfer_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* 4 byte VPD header omitted from data buff */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* 4 byte VPD header omitted from data buff */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opt_xfer_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opt_xfer_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_inquiry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_inquiry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">evpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">INQUIRY_EVPD</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">1</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">evpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">INQUIRY_EVPD</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">1</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">devtype</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">devtype</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">lu_phy_attr</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">lu_phy_attr</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">256</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">256</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">evpd</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">evpd</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;%x %x\n&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;%x %x\n&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">devtype</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">qualifier</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x7</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">devtype</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">qualifier</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x7</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">devtype</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">device_type</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x1f</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">devtype</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">device_type</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x1f</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">evpd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span> <span class="TextSegElementComment">/* no VPD, return standard Inquiry data */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">evpd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span> <span class="TextSegElementComment">/* no VPD, return standard Inquiry data */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">desc</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">desc</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">devtype</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">devtype</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x80</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x80</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; data[2] = 5;&nbsp; &nbsp; /* SPC-3 */</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; data[2] = <span class="TextSegSigDiff">0x0</span>5; /* SPC-3 */</td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x12</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x12</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&lt;&gt;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">data</span><span class="TextSegSigDiff">[</span><span class="TextSegSigDiff">5</span><span class="TextSegSigDiff">]</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0x08</span><span class="TextSegSigDiff">;</span><span class="TextSegInsigDiff"> </span><span class="TextSegInsigDiff">/* A Third-Party Copy (3PC) Enable the XCOPY */</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; data[7] = 0x02;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; data[7] = 0x02;<span class="TextSegInsigDiff"> </span><span class="TextSegInsigDiff">/* CmdQueue */</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0x20</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">28</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0x20</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">28</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">VENDOR_ID_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">VENDOR_ID_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">PRODUCT_ID_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">PRODUCT_ID_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">PRODUCT_REV_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">strncpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">PRODUCT_REV_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">desc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementOperator">*)(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">58</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">desc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementOperator">*)(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">58</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">ARRAY_SIZE</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">version_desc</span><span class="TextSegElementOperator">);</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">ARRAY_SIZE</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">version_desc</span><span class="TextSegElementOperator">);</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">desc</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be16</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">version_desc</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">desc</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be16</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">version_desc</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">66</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">66</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* Additional Length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* Additional Length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span> <span class="TextSegElementComment">/* return requested page of VPD */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span> <span class="TextSegElementComment">/* return requested page of VPD */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">0x0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">0x0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cnt</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cnt</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">devtype</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">devtype</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cnt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cnt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">ARRAY_SIZE</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">);</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">ARRAY_SIZE</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">);</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">])</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">])</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cnt</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cnt</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cnt</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cnt</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cnt</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cnt</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">)])</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">)])</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">)];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">)];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">devtype</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">devtype</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_id</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_id</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TYPE_NO_LUN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TYPE_NO_LUN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_report_luns</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_report_luns</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">list_head</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">dev_list</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">c_target</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">device_list</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">list_head</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">dev_list</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">c_target</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">device_list</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">plun</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">plun</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">plun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">plun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">remain_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">remain_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* accumulate LUN list length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* accumulate LUN list length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">dev_list</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">device_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">dev_list</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">device_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x1</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">30</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">|</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x1</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">30</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">|</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">((</span><span class="TextSegElementNumber">0x3fff</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">((</span><span class="TextSegElementNumber">0x3fff</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lun</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">plun</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*)</span><span class="TextSegElementIdentifier">plun</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*)&amp;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*)&amp;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">plun</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">plun</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*((</span><span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementOperator">*)</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*((</span><span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementOperator">*)</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_start_stop</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_start_stop</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">start</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">loej</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pwrcnd</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">start</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">loej</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pwrcnd</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pwrcnd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pwrcnd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pwrcnd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pwrcnd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">loej</span>&nbsp;&nbsp; <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">loej</span>&nbsp;&nbsp; <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">start</span>&nbsp; <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">start</span>&nbsp; <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">loej</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">start</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">loej</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">start</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_prevent_removal</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_prevent_removal</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/*&nbsp; online == media is present */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/*&nbsp; online == media is present */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_MEDIUM_REMOVAL_PREVENTED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_MEDIUM_REMOVAL_PREVENTED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* !online == media is not present */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* !online == media is not present */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NOT_READY</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NOT_READY</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_MEDIUM_REMOVAL_PREVENTED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_MEDIUM_REMOVAL_PREVENTED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">spc_lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">spc_lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">loej</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">start</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">loej</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">start</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">spc_lu_online</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">spc_lu_online</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_test_unit</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_test_unit</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* how should we test a backing-storage file? */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* how should we test a backing-storage file? */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NOT_READY</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_MEDIUM_NOT_PRESENT</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NOT_READY</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_MEDIUM_NOT_PRESENT</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NOT_READY</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_BECOMING_READY</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NOT_READY</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_BECOMING_READY</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_prevent_allow_media_removal</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_prevent_allow_media_removal</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">it_nexus_lu_info</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">itn_lu_info</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">itn_lu_info</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">it_nexus_lu_info</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">itn_lu_info</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">itn_lu_info</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">itn_lu_info</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prevent</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PREVENT_MASK</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">itn_lu_info</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prevent</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PREVENT_MASK</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_mode_select</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_mode_select</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">update</span><span class="TextSegElementOperator">)(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementOperator">*))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">update</span><span class="TextSegElementOperator">)(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementOperator">*))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sp</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sp</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">in_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">in_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_PARMS</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_PARMS</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">parameter_header_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">parameter_header_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">block_descriptor_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">block_descriptor_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">add_ua</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">add_ua</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">device_reserved</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x10</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x10</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pf</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">sp</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pf</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">sp</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">MODE_SELECT</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">MODE_SELECT</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">in_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">in_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">parameter_header_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">parameter_header_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">MODE_SELECT_10</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">MODE_SELECT_10</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">in_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">in_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">parameter_header_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">parameter_header_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">eprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;bug %u\n&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">eprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;bug %u\n&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">exit</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">exit</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">parameter_header_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">parameter_header_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">parameter_header_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">parameter_header_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">MODE_SELECT</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">MODE_SELECT</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">block_descriptor_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">block_descriptor_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">block_descriptor_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">block_descriptor_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">block_descriptor_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">block_descriptor_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">block_descriptor_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">block_descriptor_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_block_descriptor</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_block_descriptor</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">changed</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">changed</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x3f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x3f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mask</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mask</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">v</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">v</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">v</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]</span> ^ <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">v</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]</span> ^ <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">v</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">v</span> <span class="TextSegElementOperator">&amp;</span> ~<span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">v</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">v</span> <span class="TextSegElementOperator">&amp;</span> ~<span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">changed</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">changed</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">changed</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">changed</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">changed</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">changed</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">add_ua</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">add_ua</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">offset</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">add_ua</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">add_ua</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_other_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_itn_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_other_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_itn_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_MODE_PARAMETERS_CHANGED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_MODE_PARAMETERS_CHANGED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">in_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">offset</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_PARAMETER_LIST_LENGTH_ERR</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_PARAMETER_LIST_LENGTH_ERR</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">set_mode_page_changeable_mask</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">set_mode_page_changeable_mask</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mask</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/**</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/**</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* build_mode_page - static routine used by spc_mode_sense()</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* build_mode_page - static routine used by spc_mode_sense()</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* @data:&nbsp;&nbsp; destination pointer</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* @data:&nbsp;&nbsp; destination pointer</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* @m:&nbsp; &nbsp; &nbsp; struct mode pointer (src of data)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* @m:&nbsp; &nbsp; &nbsp; struct mode pointer (src of data)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Description: Copy mode page data from list into SCSI data so it can</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Description: Copy mode page data from list into SCSI data so it can</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* be returned to the initiator</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* be returned to the initiator</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Returns number of bytes copied.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Returns number of bytes copied.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Returns remaining alloc length in out-param remain_len</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Returns remaining alloc length in out-param remain_len</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">build_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">build_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pc</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pc</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementNumber">0x40</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementNumber">0x40</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">hdr</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">hdr_size</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pc</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pc</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mode_data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Set a byte at the given index within dst buffer to val,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Set a byte at the given index within dst buffer to val,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* not exceeding dst_len bytes available at dst.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* not exceeding dst_len bytes available at dst.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">index</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">dst_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">val</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">index</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">dst_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">val</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">index</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">dst_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">index</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">dst_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">index</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">val</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">index</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">val</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/**</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/**</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* spc_mode_sense - Implement SCSI op MODE SENSE(6) and MODE SENSE(10)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* spc_mode_sense - Implement SCSI op MODE SENSE(6) and MODE SENSE(10)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Reference : SPC4r11</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* Reference : SPC4r11</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6.11 - MODE SENSE(6)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6.11 - MODE SENSE(6)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6.12 - MODE SENSE(10)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* 6.12 - MODE SENSE(10)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_mode_sense</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_mode_sense</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">mode6</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">dbd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">blk_desc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pctrl</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">mode6</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">dbd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">blk_desc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pctrl</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">hdr_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mod_data_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">hdr_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mod_data_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">mode6</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">0x1a</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">mode6</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">0x1a</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">dbd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x8</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* Disable Block Descriptors */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">dbd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x8</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* Disable Block Descriptors */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">dbd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">dbd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x3f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x3f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pctrl</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xc0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pctrl</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xc0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pctrl</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pctrl</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_SAVING_PARMS_UNSUP</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_SAVING_PARMS_UNSUP</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">mode6</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">mode6</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">hdr_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">hdr_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">hdr_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">hdr_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">hdr_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">remain_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">remain_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">dbd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">dbd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_block_descriptor</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_block_descriptor</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">BLOCK_DESCRIPTOR_LEN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">0x3f</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementNumber">0x3f</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">build_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">build_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pctrl</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pctrl</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">build_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">build_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pctrl</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pctrl</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">mode6</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">mode6</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">mod_data_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">set_byte_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">blk_desc_len</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">report_opcodes_all</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">report_opcodes_all</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2048</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2048</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">device_type_operations</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">device_type_operations</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ops</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ops</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">NR_SCSI_OPCODES</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">NR_SCSI_OPCODES</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">cmd_perform</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">spc_illegal_op</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">cmd_perform</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">spc_illegal_op</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_bs_support_opcode</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">bst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_bs_support_opcode</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">bst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* this command does not take a service action, so just</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* this command does not take a service action, so just</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; report the opcode</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; report the opcode</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* service action */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* service action */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* flags : no service action, possibly timeout desc */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* flags : no service action, possibly timeout desc */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x02</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0x00</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x02</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0x00</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* cdb length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* cdb length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_scsi_command_size</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_scsi_command_size</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* timeout descriptor */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* timeout descriptor */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* length == 0x0a */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* length == 0x0a */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0a</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0a</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_perform</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_perform</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* opcode */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* opcode */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* service action */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* service action */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* flags : service action, possibly timeout desc */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* flags : service action, possibly timeout desc */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x03</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x03</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* cdb length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* cdb length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_scsi_command_size</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_scsi_command_size</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* timeout descriptor */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* timeout descriptor */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* length == 0x0a */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* length == 0x0a */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0a</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0a</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">-</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">-</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">report_opcode_one</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">report_opcode_one</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">sa</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">is_service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">sa</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">is_service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">device_type_operations</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">device_type_operations</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">256</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">256</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ops</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ops</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_bs_support_opcode</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">bst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_bs_support_opcode</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">bst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">is_service_action</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">is_service_action</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">||</span>&nbsp; <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_service_action</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">||</span>&nbsp; <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_service_action</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* reserved */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* ctdp and support */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* ctdp and support */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x83</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0x03</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">0x83</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0x03</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* cdb length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* cdb length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_scsi_command_size</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_scsi_command_size</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">++</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cdb_length</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xff</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* cdb usage data */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* cdb usage data */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">get_scsi_cdb_usage_data</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">get_scsi_cdb_usage_data</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">cdb_length</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* timeout descriptor */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* timeout descriptor */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* length == 0x0a */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* length == 0x0a */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0a</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0a</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_report_supported_opcodes</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_report_supported_opcodes</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">reporting_options</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">reporting_options</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">requested_service_action</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">requested_service_action</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reporting_options</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x07</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reporting_options</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x07</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">opcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">opcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">requested_service_action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">requested_service_action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">rctd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reporting_options</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reporting_options</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0x00</span><span class="TextSegElementOperator">:</span> <span class="TextSegElementComment">/* report all */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0x00</span><span class="TextSegElementOperator">:</span> <span class="TextSegElementComment">/* report all */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">report_opcodes_all</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">report_opcodes_all</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">:</span> <span class="TextSegElementComment">/* report one no service action*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">:</span> <span class="TextSegElementComment">/* report one no service action*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">report_opcode_one</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">report_opcode_one</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">requested_service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">requested_service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">:</span> <span class="TextSegElementComment">/* report one service action */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">:</span> <span class="TextSegElementComment">/* report one service action */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">report_opcode_one</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">report_opcode_one</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">rctd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">opcode</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">requested_service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">requested_service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">int</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">spc_report_target_groups</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">int</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">host_no</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">struct</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">scsi_cmd</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">*</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">int</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ret</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">unsigned</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">char</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">key</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ILLEGAL_REQUEST</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">uint16_t</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">asc</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ASC_INVALID_OP_CODE</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">Log_debug</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">&quot;spc_report_target_groups cmd:0x%x buffer length: %u\n&quot;</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">scb</span><span class="TextSegSigDiff">[</span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">scsi_get_in_length</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">ret</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">device_reserved</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">ret</span><span class="TextSegSigDiff">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">return</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">dev</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">attrs</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">removable</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">&amp;&amp;</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">!</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">dev</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">attrs</span><span class="TextSegSigDiff">.</span><span class="TextSegSigDiff">online</span><span class="TextSegSigDiff">)</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">key</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">NOT_READY</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">asc</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ASC_MEDIUM_NOT_PRESENT</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">goto</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">sense</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">ret</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">dev</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">bst</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">bs_cmd_submit</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">if</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">ret</span><span class="TextSegSigDiff">)</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">key</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ILLEGAL_REQUEST</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">asc</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">ASC_INVALID_OP_CODE</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">}</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="TextSegSigDiff">return</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">SAM_STAT_GOOD</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">sense</span><span class="TextSegSigDiff">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">Log_error</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">&quot;spc_report_target_groups sense, cmd:0x%x key: %d, asc: %d\n&quot;</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">scb</span><span class="TextSegSigDiff">[</span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">],</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">int</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">key</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">int</span><span class="TextSegSigDiff">)</span><span class="TextSegSigDiff">asc</span><span class="TextSegSigDiff">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">-&gt;</span><span class="TextSegSigDiff">offset</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">=</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">scsi_set_in_resid_by_actual</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">scsi_set_out_resid_by_actual</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">0</span><span class="TextSegSigDiff">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">sense_data_build</span><span class="TextSegSigDiff">(</span><span class="TextSegSigDiff">cmd</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">key</span><span class="TextSegSigDiff">,</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">asc</span><span class="TextSegSigDiff">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegSigDiff">return</span><span class="TextSegInsigDiff"> </span><span class="TextSegSigDiff">SAM_STAT_CHECK_CONDITION</span><span class="TextSegSigDiff">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSigMod"><span class="TextSegSigDiff">}</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemInsigMod">&nbsp;</td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementIdentifier">maint_in_service_actions</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementIdentifier">maint_in_service_actions</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0x0c</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_report_supported_opcodes</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0x0c</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_report_supported_opcodes</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionAll">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">-+</td>
<td class="TextItemInsigMod"><span class="TextSegInsigDiff">&nbsp;&nbsp;&nbsp; </span><span class="TextSegInsigDiff">/*{0x0a, spc_report_target_groups},*/</span></td>
</tr>
<tr class="SectionBegin">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">=</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">find_service_action</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">find_service_action</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_perform</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_perform</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_send_diagnostics</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_send_diagnostics</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* we only support SELF-TEST==1 */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* we only support SELF-TEST==1 */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x04</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x04</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* This is useful for the various commands using the SERVICE ACTION</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* This is useful for the various commands using the SERVICE ACTION</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* format.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;* format.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_service_action</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_service_action</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">op</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">op</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">actions</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">actions</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x1f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x1f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actions</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">op</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actions</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">op</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">service_actions</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_service_action</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">actions</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_service_action</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">actions</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">action</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_perform</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">service_action</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_perform</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_read_keys</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_read_keys</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">reg_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">reg_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">remain_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">remain_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">__cpu_to_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">remain_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*)&amp;</span><span class="TextSegElementIdentifier">reg_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*)&amp;</span><span class="TextSegElementIdentifier">reg_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">+=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]);</span> <span class="TextSegElementComment">/* additional length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]);</span> <span class="TextSegElementComment">/* additional length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_read_reservation</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_read_reservation</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">add_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">add_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">add_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">16</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">add_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementNumber">16</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">add_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">add_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">add_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]);</span> <span class="TextSegElementComment">/* additional length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be32</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">add_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]);</span> <span class="TextSegElementComment">/* additional length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">21</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">21</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">21</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">21</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_report_capabilities</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_report_capabilities</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">get_unaligned_be16</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">avail_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be16</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span> <span class="TextSegElementComment">/* length */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">put_unaligned_be16</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">]);</span> <span class="TextSegElementComment">/* length */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* we don't set any capability for now */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* we don't set any capability for now */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* Persistent Reservation Type Mask format */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* Persistent Reservation Type Mask format */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* Type Mask Valid (TMV) */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* Type Mask Valid (TMV) */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS_ALLREG */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS_ALLREG */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x40</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS_REGONLY */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x40</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS_REGONLY */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x20</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_WRITE_EXCLUSIVE_REGONLY */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x20</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_WRITE_EXCLUSIVE_REGONLY */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x08</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x08</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_WRITE_EXCLUSIVE */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_WRITE_EXCLUSIVE */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS_ALLREG */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* PR_TYPE_EXCLUSIVE_ACCESS_ALLREG */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">avail_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementIdentifier">persistent_reserve_in_actions</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementIdentifier">persistent_reserve_in_actions</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_IN_READ_KEYS</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_read_keys</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_IN_READ_KEYS</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_read_keys</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_IN_READ_RESERVATION</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_read_reservation</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_IN_READ_RESERVATION</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_read_reservation</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_IN_REPORT_CAPABILITIES</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_report_capabilities</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_IN_REPORT_CAPABILITIES</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_report_capabilities</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">it_nexus</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">itn</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">it_nexus</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">itn</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">itn</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">itn_id</span> <span class="TextSegElementOperator">&amp;&amp;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">itn</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">itn_id</span> <span class="TextSegElementOperator">&amp;&amp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">itn</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">itn</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">check_registration_key_exists</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">check_registration_key_exists</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">__unregister</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">__unregister</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">__unregister_and_clean</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">__unregister_and_clean</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* if reservation owner goes away then so does reservation */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* if reservation owner goes away then so does reservation */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(((</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;&amp;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(((</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&amp;&amp;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_empty</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_empty</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* not all-registrants or no more registrants */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* not all-registrants or no more registrants */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* tell other registrants the reservation went away */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* tell other registrants the reservation went away */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* do not send UA to self */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* do not send UA to self */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_other_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_other_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_RESERVATIONS_RELEASED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ASC_RESERVATIONS_RELEASED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* all-registrants and there are more registrants */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* all-registrants and there are more registrants */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">registrant</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* give resvn to any sibling */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* give resvn to any sibling */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registrant</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">param_list_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">param_list_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">spec_i_pt</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">all_tg_pt</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">spec_i_pt</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">all_tg_pt</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_out_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_out_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">spec_i_pt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementIdentifier">U</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">spec_i_pt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementIdentifier">U</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">all_tg_pt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementIdentifier">U</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">all_tg_pt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementIdentifier">U</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">aptpl</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementIdentifier">U</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">aptpl</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">1</span><span class="TextSegElementIdentifier">U</span> <span class="TextSegElementOperator">&lt;&lt;</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">spec_i_pt</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementIdentifier">all_tg_pt</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">spec_i_pt</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementIdentifier">all_tg_pt</span> <span class="TextSegElementOperator">|</span> <span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/*</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/*</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * for now, we say that we don't support these bits</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * for now, we say that we don't support these bits</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * via REPORT CAPABILITIES.</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; * via REPORT CAPABILITIES.</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_register</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_register</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">force</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">force</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">force</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x1f</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_OUT_REGISTER_AND_IGNORE_EXISTING_KEY</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">force</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x1f</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_OUT_REGISTER_AND_IGNORE_EXISTING_KEY</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">force</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">force</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">__unregister_and_clean</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">__unregister_and_clean</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">force</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">force</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">zalloc</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">zalloc</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INSUFFICENT_REGISTRATION_RESOURCES</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INSUFFICENT_REGISTRATION_RESOURCES</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_itn_id</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">cmd_itn_id</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">ctime</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_add_tail</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_add_tail</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* do nothing */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">;</span> <span class="TextSegElementComment">/* do nothing */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_reserve</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_reserve</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_REGONLY</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_REGONLY</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_REGONLY</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_REGONLY</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">PR_LU_SCOPE</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">PR_LU_SCOPE</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_release</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_release</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_RELEASE_OF_PERSISTENT_RESERVATION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_RELEASE_OF_PERSISTENT_RESERVATION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_REGONLY</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_REGONLY</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_REGONLY</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_REGONLY</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* we don't send myself */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* we don't send myself */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_other_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_other_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_RELEASED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_RELEASED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_clear</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_clear</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* we don't send myself */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* we don't send myself */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_PREEMPTED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_PREEMPTED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_preempt</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_preempt</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">res_released</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remove_all_reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">res_released</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">remove_all_reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_pr_out_basic_parameter</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0xf0</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&gt;&gt;</span> <span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x0f</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_registration_key_exists</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ret</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">check_registration_key_exists</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">ret</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS_ALLREG</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_released</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_released</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">remove_all_reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">remove_all_reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_released</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">res_released</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_scope</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pr_scope</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry_safe</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">n</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">remove_all_reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">remove_all_reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_PREEMPTED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_PREEMPTED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">__unregister</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">__unregister</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span> <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">res_released</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">res_released</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">ua_sense_add_it_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">sibling</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_RELEASED</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_RESERVATIONS_RELEASED</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_register_and_move</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_pr_register_and_move</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">asc</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ASC_INVALID_FIELD_IN_CDB</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">param_list_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">param_list_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">unreg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">unreg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint64_t</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">tpid_data_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">idlen</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">tpid_data_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">idlen</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementOperator">(*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)(</span><span class="TextSegElementKeyword">int</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint64_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*,</span> <span class="TextSegElementKeyword">int</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementOperator">(*</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)(</span><span class="TextSegElementKeyword">int</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint64_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*,</span> <span class="TextSegElementKeyword">int</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">300</span><span class="TextSegElementOperator">];</span> <span class="TextSegElementComment">/* large enough? */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">300</span><span class="TextSegElementOperator">];</span> <span class="TextSegElementComment">/* large enough? */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_out_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">param_list_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_out_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">param_list_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">scsi_get_out_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">aptpl</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">17</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">aptpl</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">17</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x01</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementComment">/* not reported in capabilities */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">aptpl</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementComment">/* not reported in capabilities */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">unreg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">17</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">unreg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">17</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementNumber">0x02</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sa_res_key</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be64</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">tpid_data_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">tpid_data_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">get_unaligned_be32</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">20</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid_data_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">24</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">tpid_data_len</span> % <span class="TextSegElementNumber">4</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid_data_len</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementNumber">24</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">tpid_data_len</span> % <span class="TextSegElementNumber">4</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">24</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">tpid_data_len</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">param_list_len</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">24</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">tpid_data_len</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_RESERVATION_CONFLICT</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">list_for_each_entry</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">registration_list</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">registration_siblings</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">key</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">sa_res_key</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">found</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">found</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* we can't find the destination */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* we can't find the destination */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">found</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">found</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">id</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">tgt_drivers</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">c_target</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lid</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">transportid</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">id</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">tgt_drivers</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">c_target</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lid</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">transportid</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">idlen</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">idlen</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementKeyword">id</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">nexus_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid_data_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">idlen</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">memcmp</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">idlen</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid_data_len</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">idlen</span> <span class="TextSegElementOperator">||</span> <span class="TextSegElementIdentifier">memcmp</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tpid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">24</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">idlen</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">dst</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">unreg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">unreg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">__unregister</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">__unregister</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">prgeneration</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">sense</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">key</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">asc</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementIdentifier">persistent_reserve_out_actions</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">service_action</span> <span class="TextSegElementIdentifier">persistent_reserve_out_actions</span><span class="TextSegElementOperator">[]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_REGISTER</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_register</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_REGISTER</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_register</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_RESERVE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_reserve</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_RESERVE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_reserve</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_RELEASE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_release</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_RELEASE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_release</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_CLEAR</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_clear</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_CLEAR</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_clear</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_PREEMPT</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_preempt</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_PREEMPT</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_preempt</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementComment">/*&nbsp; {PR_OUT_PREEMPT_AND_ABORT, spc_pr_preempt}, */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementComment">/*&nbsp; {PR_OUT_PREEMPT_AND_ABORT, spc_pr_preempt}, */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_REGISTER_AND_IGNORE_EXISTING_KEY</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_register</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_REGISTER_AND_IGNORE_EXISTING_KEY</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_register</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_REGISTER_AND_MOVE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_register_and_move</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">PR_OUT_REGISTER_AND_MOVE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">spc_pr_register_and_move</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_access_check</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_access_check</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">op</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">unsigned</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">op</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">bits</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">bits</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">registration</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lookup_registration_by_nexus</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">it_nexus</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementIdentifier">is_pr_holder</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_holder</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pr_type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">op</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">pr_conflict_bits</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">ops</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">op</span><span class="TextSegElementOperator">].</span><span class="TextSegElementIdentifier">pr_conflict_bits</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_EXCLUSIVE_ACCESS</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_EA_FA</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_EA_FA</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span> <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span> <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_WE_FA</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_WE_FA</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">reg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_RR_FR</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_RR_FR</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_REGONLY</span> <span class="TextSegElementOperator">||</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_REGONLY</span> <span class="TextSegElementOperator">||</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pr_type</span> <span class="TextSegElementOperator">==</span> <span class="TextSegElementIdentifier">PR_TYPE_WRITE_EXCLUSIVE_ALLREG</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_WE_FN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_WE_FN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_EA_FN</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">conflict</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">bits</span> <span class="TextSegElementOperator">&amp;</span> <span class="TextSegElementIdentifier">PR_EA_FN</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">conflict</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">conflict</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_request_sense</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_request_sense</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint32_t</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">alloc_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">min_t</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint32_t</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">scsi_get_in_length</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NO_SENSE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NO_ADDITIONAL_SENSE</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NO_SENSE</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NO_ADDITIONAL_SENSE</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">actual_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">spc_memcpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">scsi_get_in_buffer</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">),</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">alloc_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_buffer</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_buffer</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">actual_len</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* reset sense buffer in cmnd */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* reset sense buffer in cmnd */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_buffer</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_buffer</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">memset</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_buffer</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_buffer</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_len</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_GOOD</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">zalloc</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">zalloc</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">vpd_pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">alloc_mode_pg</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">alloc_mode_pg</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">zalloc</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">*</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">zalloc</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">*</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">pcode_size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">add_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">add_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint16_t</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">subpcode</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">find_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_mode_pg</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_mode_pg</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">size</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_NOMEM</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_NOMEM</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">exit</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">goto</span> <span class="TextSegElementIdentifier">exit</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_add_tail</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_add_tail</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_data</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strtol</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementIdentifier">UINT8_MAX</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">tmp</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementIdentifier">UINT8_MAX</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">eprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;Incorrect value %d &quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">eprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;Incorrect value %d &quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot;Mode page %d (0x%02x), index: %d\n&quot;</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot;Mode page %d (0x%02x), index: %d\n&quot;</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">data</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">-</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">uint8_t</span><span class="TextSegElementOperator">)</span><span class="TextSegElementIdentifier">tmp</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strchr</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">':'</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strchr</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">':'</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">++;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">++;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&gt;</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_INVALID_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_INVALID_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">eprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;Mode Page %d (0x%02x): param_count %d &gt; &quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">eprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;Mode Page %d (0x%02x): param_count %d &gt; &quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot;MODE PAGE size : %d\n&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot;MODE PAGE size : %d\n&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">pcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">subpcode</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">size</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">exit</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">exit</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">adm_err</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">adm_err</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">dump_cdb</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">dump_cdb</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cdb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">uint8_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cdb</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scb_len</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x\n&quot;</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x\n&quot;</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x\n&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x\n&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x&quot;</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x&quot;</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x %02x %02x\n&quot;</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x %02x %02x\n&quot;</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">11</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">11</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementNumber">16</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">dprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;SCSI CMD: %02x %02x %02x %02x %02d %02x&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x %02x %02x&quot;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x %02x %02x&quot;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x\n&quot;</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementString">&quot; %02x %02x %02x %02x\n&quot;</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">2</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">4</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">5</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">11</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">6</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">7</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">8</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">11</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">13</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">14</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">15</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">12</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">13</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">14</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementIdentifier">cdb</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">15</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_illegal_op</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_illegal_op</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">host_no</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_cmd</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">dump_cdb</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">dump_cdb</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">scsi_set_in_resid_by_actual</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_INVALID_OP_CODE</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">sense_data_build</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">cmd</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ILLEGAL_REQUEST</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">ASC_INVALID_OP_CODE</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">SAM_STAT_CHECK_CONDITION</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">enum</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">enum</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_scsi_sn</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_scsi_sn</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_product_id</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_product_id</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_sense_format</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_sense_format</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_lbppbe</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_la_lba</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_lbppbe</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_la_lba</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_optimal_xfer_gran</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_optimal_xfer_len</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_optimal_xfer_gran</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_optimal_xfer_len</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_removable</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_readonly</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_online</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_removable</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_readonly</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_online</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_mode_page</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_mode_page</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_path</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_bsopts</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_path</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_bsopts</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_bsoflags</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_thinprovisioning</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_bsoflags</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">Opt_thinprovisioning</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_err</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">Opt_err</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementIdentifier">match_table_t</span> <span class="TextSegElementIdentifier">tokens</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">static</span> <span class="TextSegElementIdentifier">match_table_t</span> <span class="TextSegElementIdentifier">tokens</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;scsi_id=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;scsi_id=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_scsi_sn</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;scsi_sn=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_scsi_sn</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;scsi_sn=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;vendor_id=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;vendor_id=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_product_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;product_id=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_product_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;product_id=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;product_rev=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;product_rev=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_sense_format</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;sense_format=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_sense_format</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;sense_format=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_lbppbe</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;lbppbe=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_lbppbe</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;lbppbe=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_la_lba</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;la_lba=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_la_lba</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;la_lba=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_optimal_xfer_gran</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;optimal_xfer_gran=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_optimal_xfer_gran</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;optimal_xfer_gran=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_optimal_xfer_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;optimal_xfer_len=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_optimal_xfer_len</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;optimal_xfer_len=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_removable</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;removable=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_removable</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;removable=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_readonly</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;readonly=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_readonly</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;readonly=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_online</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;online=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_online</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;online=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_mode_page</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;mode_page=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_mode_page</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;mode_page=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_path</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;path=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_path</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;path=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_bsopts</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;bsopts=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_bsopts</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;bsopts=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_bsoflags</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;bsoflags=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_bsoflags</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;bsoflags=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_thinprovisioning</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;thin_provisioning=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_thinprovisioning</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;thin_provisioning=%s&quot;</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_err</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">},</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">{</span><span class="TextSegElementIdentifier">Opt_err</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">},</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">};</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">spc_lu_online</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">spc_lu_online</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">spc_lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">spc_lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_prevent_removal</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_prevent_removal</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">TGTADM_PREVENT_REMOVAL</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">TGTADM_PREVENT_REMOVAL</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">online</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">lu_config</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">match_fn_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">fn</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">lu_config</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">match_fn_t</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">fn</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">TGTADM_SUCCESS</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1024</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">char</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">1024</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">lu_phy_attr</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">lu_phy_attr</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">**</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">**</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">params</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">strncmp</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;targetOps&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">params</span> <span class="TextSegElementOperator">&amp;&amp;</span> <span class="TextSegElementOperator">!</span><span class="TextSegElementIdentifier">strncmp</span><span class="TextSegElementOperator">(</span><span class="TextSegElementString">&quot;targetOps&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementNumber">9</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">params</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">params</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">params</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">params</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementNumber">10</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strsep</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;,&quot;</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">((</span><span class="TextSegElementIdentifier">p</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">strsep</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;,&quot;</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">!=</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">substring_t</span> <span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">MAX_OPT_ARGS</span><span class="TextSegElementOperator">];</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">substring_t</span> <span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">MAX_OPT_ARGS</span><span class="TextSegElementOperator">];</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">token</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">token</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!*</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">continue</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">token</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">match_token</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tokens</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">token</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">match_token</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tokens</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">token</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">switch</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">token</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_scsi_id</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_scsi_id</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x83</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x83</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_scsi_sn</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_scsi_sn</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_vendor_id</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_vendor_id</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_product_id</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_product_id</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_id</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_id</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_product_rev</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_product_rev</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_sense_format</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_sense_format</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_format</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">sense_format</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_lbppbe</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_lbppbe</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lbppbe</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lbppbe</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">no_auto_lbppbe</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">no_auto_lbppbe</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">1</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_la_lba</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_la_lba</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">la_lba</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">la_lba</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_optimal_xfer_gran</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_optimal_xfer_gran</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">update_b0_opt_xfer_gran</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">update_b0_opt_xfer_gran</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_optimal_xfer_len</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_optimal_xfer_len</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">update_b0_opt_xfer_len</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">update_b0_opt_xfer_len</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_removable</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_removable</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">removable</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">removable</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_readonly</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_readonly</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">readonly</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">readonly</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_thinprovisioning</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_thinprovisioning</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">thinprovisioning</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">thinprovisioning</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* update the provisioning vpd page */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementComment">/* update the provisioning vpd page */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb2</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb2</span><span class="TextSegElementOperator">)]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_online</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_online</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">))</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">atoi</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">))</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_online</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_online</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">else</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_mode_page</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_mode_page</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">add_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">add_mode_page</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_path</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">case</span> <span class="TextSegElementIdentifier">Opt_path</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">match_strncpy</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementOperator">&amp;</span><span class="TextSegElementIdentifier">args</span><span class="TextSegElementOperator">[</span><span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">],</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">));</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">tgt_device_path_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">tgt_device_path_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">buf</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">break</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">default</span><span class="TextSegElementOperator">:</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">fn</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementIdentifier">fn</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementIdentifier">TGTADM_INVALID_REQUEST</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">adm_err</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">fn</span> <span class="TextSegElementOperator">?</span> <span class="TextSegElementIdentifier">fn</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">p</span><span class="TextSegElementOperator">)</span> <span class="TextSegElementOperator">:</span> <span class="TextSegElementIdentifier">TGTADM_INVALID_REQUEST</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">adm_err</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">adm_err</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">spc_lu_config</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementIdentifier">tgtadm_err</span> <span class="TextSegElementIdentifier">spc_lu_config</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">char</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">lu_config</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementIdentifier">lu_config</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">params</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_lu_init</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">spc_lu_init</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">**</span><span class="TextSegElementIdentifier">lu_vpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">**</span><span class="TextSegElementIdentifier">lu_vpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">target</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">tgt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">target</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">tgt</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">device_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">type</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">device_type</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">type</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">qualifier</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">qualifier</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0x0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">thinprovisioning</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">thinprovisioning</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">removable</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">readonly</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">readonly</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">swp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">swp</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">sense_format</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">sense_format</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">vendor_id</span><span class="TextSegElementOperator">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;%-16s&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">VENDOR_ID</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;%-16s&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">VENDOR_ID</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">product_rev</span><span class="TextSegElementOperator">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;%s&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;0001&quot;</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;%s&quot;</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementString">&quot;0001&quot;</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;IET&nbsp; &nbsp;&nbsp; %04x%04&quot;</span> <span class="TextSegElementIdentifier">PRIx64</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;IET&nbsp; &nbsp;&nbsp; %04x%04&quot;</span> <span class="TextSegElementIdentifier">PRIx64</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">),</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">snprintf</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementKeyword">sizeof</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">),</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;beaf%d%&quot;</span> <span class="TextSegElementIdentifier">PRIu64</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementString">&quot;beaf%d%&quot;</span> <span class="TextSegElementIdentifier">PRIu64</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">tgt</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">tid</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span> <span class="TextSegElementOperator">&lt;&lt;=</span> <span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span> <span class="TextSegElementOperator">&lt;&lt;=</span> <span class="TextSegElementNumber">32</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">numeric_id</span> <span class="TextSegElementOperator">|=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">lun</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0x80 */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0x80 */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x80</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">SCSI_SN_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">SCSI_SN_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_80</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_80</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_sn</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0x83 */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0x83 */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x83</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0x83</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">DESG_HDR_LEN</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN_EXTD</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">3</span><span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">DESG_HDR_LEN</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">SCSI_ID_LEN</span> <span class="TextSegElementOperator">+</span> <span class="TextSegElementIdentifier">NAA_DESG_LEN_EXTD</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_83</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_83</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">scsi_id</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0xb0 */</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0xb0 */</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb0</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">BLOCK_LIMITS_VPD_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">BLOCK_LIMITS_VPD_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_b0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_b0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0xb2 LOGICAL BLOCK PROVISIONING*/</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementComment">/* VPD page 0xb2 LOGICAL BLOCK PROVISIONING*/</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb2</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">PCODE_OFFSET</span><span class="TextSegElementOperator">(</span><span class="TextSegElementNumber">0xb2</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">LBP_VPD_LEN</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">alloc_vpd</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">LBP_VPD_LEN</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementOperator">-</span><span class="TextSegElementIdentifier">ENOMEM</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_b2</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">update_vpd_b2</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">]-&gt;</span><span class="TextSegElementIdentifier">vpd_update</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">,</span> <span class="TextSegElementIdentifier">NULL</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">dev_type_template</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_offline</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">return</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">spc_lu_exit</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementKeyword">void</span> <span class="TextSegElementIdentifier">spc_lu_exit</span><span class="TextSegElementOperator">(</span><span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">scsi_lu</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">int</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">**</span><span class="TextSegElementIdentifier">lu_vpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">vpd</span> <span class="TextSegElementOperator">**</span><span class="TextSegElementIdentifier">lu_vpd</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">ARRAY_SIZE</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">);</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">for</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementNumber">0</span><span class="TextSegElementOperator">;</span> <span class="TextSegElementIdentifier">i</span> <span class="TextSegElementOperator">&lt;</span> <span class="TextSegElementIdentifier">ARRAY_SIZE</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">attrs</span><span class="TextSegElementOperator">.</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">);</span> <span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">++)</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">])</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">if</span> <span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">])</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">lu_vpd</span><span class="TextSegElementOperator">[</span><span class="TextSegElementIdentifier">i</span><span class="TextSegElementOperator">]);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;</td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;</td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">list_empty</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementKeyword">while</span> <span class="TextSegElementOperator">(!</span><span class="TextSegElementIdentifier">list_empty</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">))</span> <span class="TextSegElementOperator">{</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span> <span class="TextSegElementOperator">*</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">;</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">list_first_entry</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">pg</span> <span class="TextSegElementOperator">=</span> <span class="TextSegElementIdentifier">list_first_entry</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">lu</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pages</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span><span class="TextSegElementOperator">,</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementKeyword">struct</span> <span class="TextSegElementIdentifier">mode_pg</span><span class="TextSegElementOperator">,</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">list_del</span><span class="TextSegElementOperator">(&amp;</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">-&gt;</span><span class="TextSegElementIdentifier">mode_pg_siblings</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">);</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <span class="TextSegElementIdentifier">free</span><span class="TextSegElementOperator">(</span><span class="TextSegElementIdentifier">pg</span><span class="TextSegElementOperator">);</span></td>
</tr>
<tr class="SectionMiddle">
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame">&nbsp;&nbsp;&nbsp; <span class="TextSegElementOperator">}</span></td>
</tr>
<tr class="SectionEnd">
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
<td class="AlignCenter">&nbsp;</td>
<td class="TextItemSame"><span class="TextSegElementOperator">}</span></td>
</tr>
</table>
<br/>
</body>
</html>
